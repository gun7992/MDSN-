User mode and kernel mode

[원본 링크](https://docs.microsoft.com/ko-kr/windows-hardware/drivers/gettingstarted/user-mode-and-kernel-mode)

```
Windows를 실행하고 있는 컴퓨터의 프로세서는 커널모드와 유저모드라는 두 가지의 서로 다른 모드를 가진다.

프로세서는 그 위에서 동작하는 코드의 타입에 따라서 두 모드를 왔다 갔다한다.

어플리케이션은 유저모드에서 동작하고, 핵심 OS 요소들은 커널모드에서 동작한다.

많은 드라이버들이 커널모드에서 동작하지만, 몇몇 드라이버들은 유저모드에서 동작한다.
```

```
당신이 유저모드 어플리케이션을 실행하면, Windows는 그 어플리케이션을 위한 프로세스를 만든다.

그 프로세스는 어플리케이션에게 private 가상 주소 공간과 private 핸들 테이블을 제공한다.

왜냐하면 어플리케이션의 가상 주소 공간은 private하고, 다른 어플리케이션에 속한 데이터는 바꿀 수 없기 때문이다.

각각의 어플리케이션은 독립되어 동작하고, 만약 어플리케이션이 충돌할 경우, 그 충돌은 그 어플리케이션에 한정된다.(다른 어플리케이션에 영향을 줄 수 없다.)

다른 어플리케이션이나 운영 체제는 그 충돌의 영향을 받지 않는다.
```

```
또한 private의 관점에서, 한 유저모드 어플리케이션의 가상 주소 공간은 한정되어 있다.(차원적인 관점에서의 한정)

유저모드에서 동작하고 있는 프로세서는 OS에 할당된 가상 주소들에 접근할 수 없다.

유저모드 어플리케이션의 가상 주소 공간을 제한하는 것은 어플리케이션이 바뀌거나, 중요한 OS의 데이터를 오염시키는 것을 막는다.
```

```
커널 모드에서 동작하는 모든 코드들은 하나의 가상 주소 공간을 공유한다.

이 말은, 한 커널모드 드라이버가 다른 커널모드 드라이버나 OS 자체와 독립되어 있지 않다는 말이다.(커널모드 드라이버들과 OS는 같은 메모리 영역을 사용한다.)


만약 커널모드 드라이버가 잘못된 가상 주소나 OS, 다른 드라이버에 속한 데이터에 write를 하는 사고가 발생한다면, 타협이 필요하다.(이런 사고가 발생하게 된다면 어느 정도의 희생이 필요하다는 뜻)

만약 커널모드 드라이버가 충돌하면, OS 전체가 충돌한다.
```

```
아래의 커널모드와 유저모드 간의 커뮤니케이션을 도식화 한 것이다.
```

![Communication between user-mode and kernel-mode](https://docs.microsoft.com/ko-kr/windows-hardware/drivers/gettingstarted/images/userandkernelmode01.png)
